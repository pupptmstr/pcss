# PCSP (positive content sharing protocol)
Данный протокол создавался для общения и передачи позитивного контента между участниками-клиентами. 
## Формат передачи данных
Назовем одно сообщение с клиента на сервер или в обратную сторону - Message'ом. Message состоит из Header'а, 
Data'ы, и массива байтов (файла), если он прикреплен. Полный формат сообщения:
`[messageType],[isFileAttached],[dataSize]_;_[messageId],[senderName],[time],[messageText],[fileName]_;_Base64FileByteArray`
### Header
`[messageType],[isFileAttached],[dataSize]_;`

Где:
1) messageType - тип сообщения. Может принимать значения 0(Login), 1(Special), 2(Message).
   1) Login - передается в самом начале при установлении соединения. Используется только для регистрации пользователя в чате
   2) Special - зарезервированный тип для возможного расширения возможностей протокола (отправка управляющих сообщений)
   3) Message - самый часто отправляемый тип. Простое собщение в чате
2) isFileAttached - булевая переменная (0-false, 1-true), указывающая на то, будет ли прикреплен файл к сообщению (писать сюда надо цифру)
3) dataSize - размер следующего блока (Data) в байтах

### Data
`_[messageId],[senderName],[time],[messageText],[fileName]_;`

Где:
1) messageId - уникальный идентификатор каждого сообщения (проставляется сервером) 
2) senderName - имя отправителя (которое было указано при логине)
3) time - время отправки сообщения (проставляется сервером)
4) messageText - текст сообщения
5) fileName - имя файла, если он прикреплен


## Порядок общения и установления связи
### Логин(первое подключение) 
При первом подключении клиент отправляет на сервер сообщение с messageType 0(Login) в хэдэре, в senderName записывается
желаемый никнейм, а в messageText записывается ZoneId в формате 'Europe/Moscow' (пример для московского времени).
Далее с сервера приходит ответ о том занят этот никнейм или нет. Если занят - через некоторое время сервер автоматически 
закроет сокет(клиент будет об этом уведомлен). Если нет - можно общаться от этого имени.

### Пересылка файлов
Если к сообщению был прикреплен файл, то необходимо проставить:
1) isFileAttached=1
2) fileName = имени прикрепленного файла (будет использоваться, чтобы под этим же именем сохранить файл у клиентов)
3) Поток байтов файла записать в конец мэссэджа, предварительно закодировав весь поток в Base64
(это нужно для того, чтобы все байты успешно были пересланы другим клиентам и не были испорчены по дороге)



# PCSS (positive content sharing system)

PCSS - консольный мессенджер для обмена позитивным контентом, сделанный на базе протокола PCSP.

Подключение инициируется клиентом c указанием желаемого никнейма. Если подключение успешно, 
клиент устанавливает соединение с сервером через сокет и далее в течение подключения может общаться
с другими подключенными клиентами. Для общения используется общий протокол, используемый для 
отправки сообщений обеими сторонами. Сообщение может не содержать или содержать только одно вложение, 
которое предается в конце сообщения в формате [[filepath]]. Клиент может разорвать соединение с помощью 
ключевого слова 'q', сервер закрывает соединение с данным клиетном. При закрытии сервера все клиенты об 
этом уведомляются и подключения закрываются. 
Пока ограничений на отправляемые медиафайлы нет. Так же на данный момент с каждым сообщением в чате отображается милый 
ASCII-котик. Пересланные медиафайлы сохраняются в той же папке, где лежал запускаемый jar-файл (сохраняются рядом с ним).

# Список литературы
[Регулярное выражение для времени](http://jdevnotes.blogspot.com/2011/04/blog-post_29.html) \
[Скачивание файла](https://www.tutorialkart.com/kotlin/kotlin-create-file/) \
[Гайд по Java sockets](https://www.baeldung.com/a-guide-to-java-sockets) \
[Зонирование времени в JVM](https://www.baeldung.com/java-zone-offset) \
[Обсуждение на тему правильной передачи двичной информации через сокеты](https://coderoad.ru/1536054/%D0%9A%D0%B0%D0%BA-%D0%BF%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-%D0%B1%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%D1%8B%D0%B9-%D0%BC%D0%B0%D1%81%D1%81%D0%B8%D0%B2-%D0%B2-%D1%81%D1%82%D1%80%D0%BE%D0%BA%D1%83-%D0%B8-%D0%BD%D0%B0%D0%BE%D0%B1%D0%BE%D1%80%D0%BE%D1%82) \


